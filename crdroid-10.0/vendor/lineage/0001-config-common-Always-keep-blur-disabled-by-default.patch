From 1b8918bac9172fd7cd214b3b7e35646b070e391e Mon Sep 17 00:00:00 2001
From: Vhmit <viktor.9630@protonmail.com>
Date: Wed, 1 Feb 2023 00:12:47 +0330
Subject: [PATCH 1/2] config: common: Always keep blur disabled by default

now actually behaves as intended: if set to true, blurs are disabled and
the toggle is gone from settings; if set to anything other than true, the
switch is still present in settings; if not set at all, blurs are enabled
and the switch is present in settings.

Change-Id: I4a580d056f0934e9131ae152b76278542ee7bf6d
---
 config/common.mk | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/config/common.mk b/config/common.mk
index 80abbe06..40d7eeb8 100644
--- a/config/common.mk
+++ b/config/common.mk
@@ -176,6 +176,22 @@ PRODUCT_SYSTEM_DEFAULT_PROPERTIES += \
 PRODUCT_PACKAGES_DEBUG += \
     procmem
 
+# Blur
+ifndef TARGET_ENABLE_BLUR
+    USES_BLUR=0
+endif
+
+ifeq ($(TARGET_ENABLE_BLUR),true)
+    USES_BLUR=1
+else
+    USES_BLUR=0
+endif
+
+PRODUCT_PRODUCT_PROPERTIES += \
+    ro.sf.blurs_are_expensive=$(USES_BLUR) \
+    ro.surface_flinger.supports_background_blur=$(USES_BLUR) \
+    persist.sysui.disableBlur=$(shell echo $$((1 - $(USES_BLUR))))
+
 # Root
 PRODUCT_PACKAGES += \
     adb_root
-- 
2.39.5

