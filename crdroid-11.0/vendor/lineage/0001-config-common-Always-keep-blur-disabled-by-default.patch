From b9c2ded95479ff8fde1f9c6a59f14f1f05c50a3b Mon Sep 17 00:00:00 2001
From: Vhmit <viktor.9630@protonmail.com>
Date: Wed, 1 Feb 2023 00:12:47 +0330
Subject: [PATCH 1/2] config: common: Always keep blur disabled by default

now actually behaves as intended: if set to true, blurs are disabled and
the toggle is gone from settings; if set to anything other than true, the
switch is still present in settings; if not set at all, blurs are enabled
and the switch is present in settings.

Change-Id: I7d879a2931982d11a9dc168b30748747ebc21d61
---
 config/common.mk | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/config/common.mk b/config/common.mk
index b089d15c..7e367702 100644
--- a/config/common.mk
+++ b/config/common.mk
@@ -172,6 +172,22 @@ PRODUCT_SYSTEM_DEFAULT_PROPERTIES += \
 PRODUCT_PACKAGES_DEBUG += \
     procmem
 
+# Blur
+ifndef TARGET_ENABLE_BLUR
+    USES_BLUR=0
+endif
+
+ifeq ($(TARGET_ENABLE_BLUR),true)
+    USES_BLUR=1
+else
+    USES_BLUR=0
+endif
+
+PRODUCT_PRODUCT_PROPERTIES += \
+    ro.sf.blurs_are_expensive=$(USES_BLUR) \
+    ro.surface_flinger.supports_background_blur=$(USES_BLUR) \
+    persist.sysui.disableBlur=$(shell echo $$((1 - $(USES_BLUR))))
+
 # Root
 PRODUCT_PACKAGES += \
     adb_root
-- 
2.39.5

